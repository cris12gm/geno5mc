{% extends "base.html" %}
{% load staticfiles %}

{% block css %}
    <link href="{% static 'css/customStyles/stylesQuery.css'%}" rel="stylesheet">
    <link href="{% static 'tour/introjs.css'%}" rel="stylesheet">
    <link href="{% static 'css/stylesIntroJs.css'%}" rel="stylesheet">
{% endblock %}

{% block content %}

<!-- This script enables link to tabs-->
<div class="menu-hide" id="menu-hide">

    <h1 class="titlePag"> QUERY DB</h1>
    <hr>
    <ul class="nav nav-tabs" id="tabsQuery" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="snp-tab" data-toggle="tab" href="#snp" role="tab" aria-controls="snp" aria-selected="true">By SNP ID</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="gene-tab" data-toggle="tab" href="#gene" role="tab" aria-controls="gene" aria-selected="false">By Gene ID</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="trait-tab" data-toggle="tab" href="#trait" role="tab" aria-controls="trait" aria-selected="false">By Trait</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="region-tab" data-toggle="tab" href="#region" role="tab" aria-controls="trait" aria-selected="false">By Genomic Region</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="snp" role="tabpanel" aria-labelledby="snp-tab">
            <div class="row">
                <div class="column">
                    <div class="card cardQuery" id="cardSNP">
                        <p class="card-header headerCardQuery" >Introduce a <b>SNP ID</b> to view its associations</p>
                        <p id="errorsFormSNP" class="text-danger text-center ml-2 mr-2 mt-2 font-weight-light"></p>
                        <form action="{% url 'querySNP' %}" method="POST"  id="formSNP" onsubmit="return checkformSNP();" class="formQuery">
                            {% csrf_token %}
                            <div class='form-group'">
                                <input type="text" name="SNPid" maxlength="15" required id="SNPid">
                            </div>
                            <button type="submit" id='submitSNP' class="btn btn-success btn-sm"  disabled="true">Submit</button>
                            <button id="loadExSNP" class="btn btn-info btn-sm"  disabled="true">Load Example</button>
                        </form>
                    </div>
                </div>
                <div class=column>
                    <!-- Imagen explicando busqueda por SNP -->
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="gene" role="tabpanel" aria-labelledby="gene-tab">
            <div class="row">
                <div class="column">
                    <div class="card cardQuery">
                        <p class="card-header headerCardQuery">Introduce a <b>Gene ID</b> to view its associations</p>
                        <br>
                            <form action="{% url 'queryGene' %}" method="post" id="formGene" onsubmit="return checkformGene()" class="formQuery">
                                {% csrf_token %}
                                {% for field in formGene %}
                                    <div class='form-group'>
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                <button type="submit" id='submitGene' class="btn btn-success btn-sm">Submit</button>
                                <button id="loadExGene" class="btn btn-info btn-sm">Load Example</button>
                            </form>
                    </div>
                </div>
                <div class=column>
                    <!-- Imagen explicando busqueda por Gen -->
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="trait" role="tabpanel" aria-labelledby="trait-tab">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card cardQuery cardTrait">
                        <p class="card-header headerCardQuery">Select a <b>trait</b> to view its associations</p>
                        <form action="{% url 'queryTrait' %}" method="post" onsubmit="return checkformTrait()" id="formTrait" class="formQuery">
                            {% csrf_token %}
                            <select id="traits" name="traitslist" class="selectpicker" data-live-search="true" form="formTrait">
                                {% for trait in traits %}
                                    <option value="{{trait}}">{{trait}}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" id='submitTrait' class="btn btn-success btn-sm submitTrait">Submit</button>
                        </form>  
                    </div>
                </div>          
            </div>
        </div>
        <div class="tab-pane fade" id="region" role="tabpanel" aria-labelledby="region-tab">
            <div class="row">
                <div class="column">
                    <div class="card cardQuery cardRegion">
                        <p class="card-header headerCardQuery">Introduce a <b>Genomic Region</b> to view its associations</p>
                        <p id="errorsFormRegion" class="text-danger text-center ml-2 mr-2 mt-2 font-weight-light"></p>
                        <form action="{% url 'queryRegion' %}" method="post" id="formRegion" onsubmit="return checkformRegion();" name = "formRegion" class="formQuery">
                            {% csrf_token %}
                            <select placeholder="chrom" name="chrom" id="chrom" class="chrom_select" onchange='changeChrom()' required>
                                <option value ="" selected disabled>chrom</option>
                                {% for chrom in chroms %}
                                    <option value="{{ chrom.chrom }}_{{ chrom.length }}">{{ chrom.chrom }}</option>
                                {% endfor %}
                            </select>
                            <input id="chromStart" type="number" name="chromStart" class="chromStart_select" placeholder="chromStart" min="1" required>
                            -
                            <input id="chromEnd" type="number" name="chromEnd" class="chromStart_select" placeholder="chromEnd" min="1" required>
                            <div class="mt-2">
                                <button type="submit" id='submitRegion' class="btn btn-success btn-sm">Submit</button>
                                <button id="loadExRegion" class="btn btn-info btn-sm">Load Example</button>
                                <button type="reset" class="btn btn-secondary btn-sm">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class=column>
                    <!-- Imagen explicando busqueda por Gen -->
                </div>
        </div>
    </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script src="{% static 'tour/intro.js' %}"></script>
<script>
   var intro = introJs();
    var options_before = {
        steps: [
            { 
                intro: "<center><h3>Welcome to <img src='{% static 'images/title_v4.png'%}' width='180'></h3></center>DNA methylation is related to the regulation of gene expression. This database allows to explore statistically significant associations between sequence variants (SNPs) and changes in DNA methylation (CpG dinucleotides) in functionally relevant regions (promoters and enhancers). In this tour, we   illustrate this concept using <a href='https://www.ebi.ac.uk/gwas/variants/rs727563' target='_blank'>rs727563</a>, a SNP associated with inflammatory bowel disease in a Genome Wide Association Study ((Liu et al., 2015)). Although the GWAS showed a highly significant association, no mechanistic link is known between this SNP and the mentioned phenotype. Located on chromosome 22 (chr22:41471373, GRCh38.p12) this SNP is an intron variant of the gene <a href='https://www.ncbi.nlm.nih.gov/gene/50' target='_blank'>ACO2</a> which encodes for the aconitase 2 protein. <br><br><img src={% static 'images/tutorial_1.png'%} width='800px'>The <a href='https://www.ncbi.nlm.nih.gov/gene/50' target='_blank'>ACO2</a> belongs to the aconitase/IPM isomerase family, and catalyzes the interconversion of citrate to isocitrate via cis-aconitate in the second step of the TCA cycle. Diseases associated with ACO2 include Infantile Cerebellar-Retinal Degeneration and Optic Atrophy 9 (<a href='https://www.ncbi.nlm.nih.gov/pubmed/25351951' target='_blank'>Metodiev et al., 2014</a>; <a href='https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3309186/' target='_blank'>Spiegel et al., 2012</a>) so it has <u>no apparent association</u> with inflammatory bowel disease.<br><br>In the following steps we show how this SNP is statistically associated with changes in DNA methylation in promoter regions of relevant genes, and at least some of these CpGs dinucleotides were shown to correlate with gene expression levels.",
                tooltipClass:"step1Tour"
            },
            { 
                element: document.querySelector('#tabsQuery'),
                intro: "In this section you will find the 4 different ways of querying the DB.",
                tooltipClass:"step1Tour"
            },
            { 
                element: document.querySelector('#cardSNP'),
                intro: "In this tour we will show how it works the <i>Query SNP</i> utility",
                tooltipClass:"step1Tour"
            },
            {
                element: document.querySelector('#formSNP'),
                intro: "To query a SNP, first, you will need to fill the search box with a SNP ID.",
            },
            {
                element: document.querySelector('#submitSNP'),
                intro: "Then just press <button class='btn btn-success btn-sm'>Submit</button> to see the results",
                click: true,
            },
        ],
        showStepNumbers:false,
        hideNext:true,
        disableInteraction:false,
        tooltipClass:true,
        doneLabel:"Next →",
        scrollTo:"tooltip"
    };

    intro.setOptions(options_before);

        intro.setOptions(options_before);
        intro.onbeforechange(function () {

        if (intro._currentStep == "4") {
            document.getElementById("SNPid").value = "rs727563";
            var submitB = document.getElementById("submitSNP");
            submitB.disabled = false;
        }
        });

        intro.oncomplete(function() {
            var divAll = document.getElementById("menu-hide");
            divAll.style.display="none";
            ShowLoadingTour();
            window.location.href = "{% url 'querySNP' %}/snp=rs727563";
        });
        intro.start();
</script>

{% endblock %}

