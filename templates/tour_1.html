{% extends "base.html" %}
{% load staticfiles %}

{% block css %}

<link href="{% static 'css/customStyles/stylesQuery.css'%}" rel="stylesheet">

{% endblock %}

{% block content %}

<div class="menu-hide">
    <h1 class="titlePag"> QUERY DB</h1>
    <hr>
    <ul class="nav nav-tabs" id="tabsQuery" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="snp-tab" data-toggle="tab" href="#snp" role="tab" aria-controls="snp" aria-selected="true">By SNP ID</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="gene-tab" data-toggle="tab" href="#gene" role="tab" aria-controls="gene" aria-selected="false">By Gene ID</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="trait-tab" data-toggle="tab" href="#trait" role="tab" aria-controls="trait" aria-selected="false">By Trait</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="snp" role="tabpanel" aria-labelledby="snp-tab">
            <div class="row">
                <div class="column">
                    <div class="card cardQuery">
                        <p class="card-header headerCardQuery" >Introduce a <b>SNP ID</b> to view its associations</p>
                        <form action="{% url 'querySNP' %}" method="POST"  id="formSNP" onsubmit="ShowLoading()" class="formQuery">
                            {% csrf_token %}
                            {% for field in formSNP %}
                                <div class='form-group'">
                                    {{ field }}
                                </div>
                            {% endfor %}
                            <button type="submit" id='submitSNP' class="btn btn-success btn-sm" >Submit</button>
                            <button id="loadExSNP" class="btn btn-info btn-sm">Load Example</button>
                        </form>
                    </div>
                </div>
                <div class=column>
                    <!-- Imagen explicando busqueda por SNP -->
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="gene" role="tabpanel" aria-labelledby="gene-tab">
            <div class="row">
                <div class="column">
                    <div class="card cardQuery">
                        <p class="card-header headerCardQuery">Introduce a <b>Gene ID</b> to view its associations</p>
                            <form action="{% url 'queryGene' %}" method="post" id="formGene" onsubmit="ShowLoading()" class="formQuery">
                                {% csrf_token %}
                                {% for field in formGene %}
                                    <div class='form-group'>
                                        {{ field }}
                                    </div>
                                {% endfor %}
                                <button type="submit" id='submitGene' class="btn btn-success btn-sm">Submit</button>
                                <button id="loadExGene" class="btn btn-info btn-sm">Load Example</button>
                            </form>
                    </div>
                </div>
                <div class=column>
                    <!-- Imagen explicando busqueda por Gen -->
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="trait" role="tabpanel" aria-labelledby="trait-tab">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card cardQuery cardTrait">
                        <p class="card-header headerCardQuery">Select a <b>trait</b> to view its associations</p>
                        <form action="{% url 'queryTrait' %}" method="post" onsubmit="ShowLoading()" id="formTrait" class="formQuery">
                            {% csrf_token %}
                            <select id="traits" name="traitslist" class="selectpicker" data-live-search="true" form="formTrait">
                                {% for trait in traits %}
                                    <option value="{{trait}}">{{trait}}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" id='submitTrait' class="btn btn-success btn-sm submitTrait">Submit</button>
                        </form>  
                    </div>
                </div>          
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}

<!-- Tour Script -->

<script>
    // Instance the tour
    var tour = new Tour({
    steps: [
    {
        element: "#my-element",
        title: "Title of my step",
        content: "Content of my step"
    },
    {
        element: "#my-other-element",
        title: "Title of my step",
        content: "Content of my step"
    }
    ]});

    // Initialize the tour
    tour.init();

    // Start the tour
    tour.start();
</script>

<!-- This script show an image when is loading-->
<script type="text/javascript">
    function ShowLoading(e) {
        var div = document.createElement('div');
        var img = document.createElement('img');
        img.src = "{% static 'images/wait.svg'%}";
        div.innerHTML = "<b><font color='#194a90' size='4'>Loading results, please wait</font></b>";
        div.style.cssText = 'position: fixed; top: 20%; left: 40%; z-index: 5000; width: 422px; text-align: center; background: #FFFFFF;';

        div.appendChild(img);
        document.body.appendChild(div);
        return true;
    }
    
</script>

<!-- This script cancel submit button when the form is loading and hides menu-->
<script>
    $(document).ready(function () {
        $(".formQuery").submit(function (e) {
            //disable the submit button
            $("#submitSNP").attr("disabled", true);
            $("#submitGene").attr("disabled", true);
            $("#submitTrait").attr("disabled", true);
            $("div.menu-hide").hide()
            //
            return true;
        });
    });

</script>

<!-- This script charge the example on SNP tab -->
<script>
    $(document).ready(function(){

        $('#loadExSNP').on('click', function(){
            $('#id_SNPid').val("rs727563");
            return false;
        });

        $('#loadExGene').on('click', function(){
            $('#id_GeneId').val("CYTH4");
            return false;
        });

       });
</script>


{% endblock %}